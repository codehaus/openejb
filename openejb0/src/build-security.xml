<project name="OpenEJB-Security" default="jar" basedir="../">
    <!-- 
        Contributions by:
            Daniel S. Haischt <sirabyss@gmx.net>
      -->

    <property name="build.security.src" value="${build.src}/security"/>
    <property name="build.security.dest" value="${build.dest}/security"/>
    <property name="dest.security.javadoc.dir" value="${dest.javadoc.dir}/security"/>
    <property name="build.testsuite.dest" value="${build.dest}/testsuite"/>
  
    <!-- Build classpath -->
    <path id="project.classpath">
        <pathelement location="${log4j.jar}"/>
        <pathelement location="lib/xercesImpl-2.0.2.jar"/>
        <pathelement location="${junit.jar}"/>
    </path>
  
  
    <!-- ================================================================== -->
    <!-- Prepares the build directory                                       -->
    <!-- ================================================================== -->

    <target name="prepare">
    
        <mkdir dir="${build.security.src}"/>
        <mkdir dir="${build.security.dest}"/>
        <mkdir dir="${dest.security.javadoc.dir}"/>
        
        <copy todir="${build.security.src}">
        
            <fileset dir="${src.java.dir}/security" >
                <include name="**"/>
                <exclude name="**/CVS/**"/>
                <exclude name="**/*.class"/>
            </fileset>
        
        </copy>
    
    </target>

    <target name="copy.manifest">
    
        <copy todir="${build.security.dest}">
            
            <fileset dir="${src.java.dir}/etc" >
                <include name="**/LICENSE"/>
                <include name="**/MANIFEST.MF"/>
                <include name="**/README"/>
            </fileset>
                
            <fileset dir="${final.dir}/src/etc" >
                <include name="**/CHANGELOG"/>
            </fileset>
            
            <fileset dir="${src.java.dir}/security/conf" >
                <include name="default.security.conf"/>
            </fileset>

        </copy>
        
        <copy file="${src.java.dir}/security/conf/security-jar.xml"
              tofile="${build.security.dest}/org/openejb/security/security-jar.xml"/>

        <copy file="${src.java.dir}/security/conf/service-jar.xml"
              tofile="${build.security.dest}/org/openejb/security/service-jar.xml"/>

        <replace file="${build.security.dest}/MANIFEST.MF" token="$$VERSION$$" value="${version}"/>
    
    </target>

    <target name="copy.i18n">
    
        <copy todir="${build.security.dest}">
        
            <fileset dir="${src.java.dir}/security" >
                <include name="**/resources/*.properties"/>
            </fileset>
            
        </copy>
    
    </target>

    <!-- ================================================================== -->
    <!-- Compiles the source directory                                      -->
    <!-- ================================================================== -->

    <target name="compile" description="--> compiles the java source files">
        <antcall target="compile.jdk.${ant.java.version}"/>
    </target>
    <target name="compile.jdk.1.1" depends="compile.invalid.jdk"/>
    <target name="compile.jdk.1.2" depends="compile.invalid.jdk"/>
    <target name="compile.jdk.1.3" depends="compile.valid.jdk"/>
    <target name="compile.jdk.1.4" depends="compile.valid.jdk"/>

    <target name="compile.invalid.jdk">
        <echo message="This Security Service requires JDK 1.3 or higher. You are using JDK ${ant.java.version}"/>          
    </target>

    <target name="compile.valid.jdk" depends="prepare">
        <javac srcdir="${build.security.src}"
            destdir="${build.security.dest}"
            includes="**/security/**,javax/**"
            debug="${debug}"
            deprecation="${deprecation}">
        
            <classpath>
                <path refid="project.classpath"/>
                <pathelement location="${build.dest}/openejb"/>
            </classpath>
        </javac>
    </target>


    <!-- ================================================================== -->
    <!-- Compiles the source directory and creates a .jar file              -->
    <!-- ================================================================== -->

    <target name="jar"
        depends="compile, copy.manifest, copy.i18n"
        description="--> generates all java archives (default)">
    
        <jar jarfile="dist/${project}_security-${version}.jar"
            basedir="${build.security.dest}"
            manifest="${build.security.dest}/MANIFEST.MF"/>
    
    </target>

    <!-- ================================================================== -->
    <!-- Creates the API documentation                                      -->
    <!-- ================================================================== -->

    <target name="javadocs"
        depends="compile"
        description="--> generates the API documentation">

        <javadoc packagenames="org.openejb.*"
            sourcepath="${build.security.src}"
            destdir="${dest.security.javadoc.dir}"
            doctitle="${name} security JavaDoc"
            windowtitle="${name} JavaDoc"
            bottom="${copyright}"
            package="true"
            author="true"
            version="true"
            noindex="true">
            
            <classpath>
                <path refid="project.classpath"/>
                <pathelement location="${build.dest}/openejb"/>
            </classpath>
        
        </javadoc>         
    
    </target>

</project>
