<?xml version="1.0"?>

<openejb-jar
    xmlns="http://www.openejb.org/xml/ns/openejb-jar-2.0"
    configId="openejb/cmp2-prefetch/${openejb_version}/car"
    parentId="geronimo/default-database/${geronimo_version}/car"
    >

    <dependency>
        <groupId>junit</groupId>
        <artifactId>junit</artifactId>
        <version>${junit_version}</version>
    </dependency>

    <cmp-connection-factory>
        <application>null</application>
        <module>geronimo/default-database/${geronimo_version}/car</module>
        <name>DefaultDatasource</name>
    </cmp-connection-factory>

    <enterprise-beans>
        <entity>
            <ejb-name>AddressBean</ejb-name>
            <table-name>address</table-name>
            <cmp-field-mapping>
                <cmp-field-name>id</cmp-field-name>
                <table-column>id</table-column>
            </cmp-field-mapping>
            <cmp-field-mapping>
                <cmp-field-name>street</cmp-field-name>
                <table-column>street</table-column>
            </cmp-field-mapping>
            <cmp-field-mapping>
                <cmp-field-name>city</cmp-field-name>
                <table-column>city</table-column>
            </cmp-field-mapping>
            <prefetch-group>
                <group>
                    <group-name>prefetchAll</group-name>
                    <cmp-field-name>street</cmp-field-name>
                    <cmp-field-name>city</cmp-field-name>
                </group>
            </prefetch-group>
        </entity>
        <entity>
            <ejb-name>LineItemBean</ejb-name>
            <table-name>line_item</table-name>
            <cmp-field-mapping>
                <cmp-field-name>id</cmp-field-name>
                <table-column>id</table-column>
            </cmp-field-mapping>
            <cmp-field-mapping>
                <cmp-field-name>quantity</cmp-field-name>
                <table-column>quantity</table-column>
            </cmp-field-mapping>
            <prefetch-group>
                <group>
                    <group-name>prefetchAll</group-name>
                    <cmp-field-name>quantity</cmp-field-name>
                    <cmr-field>
                        <cmr-field-name>product</cmr-field-name>
                    </cmr-field>
                </group>
                <entity-group-mapping>
                    <group-name>prefetchAll</group-name>
                </entity-group-mapping>
            </prefetch-group>
        </entity>
        <entity>
            <ejb-name>OrderBean</ejb-name>
            <table-name>order_table</table-name>
            <cmp-field-mapping>
                <cmp-field-name>id</cmp-field-name>
                <table-column>id</table-column>
            </cmp-field-mapping>
            <cmp-field-mapping>
                <cmp-field-name>reference</cmp-field-name>
                <table-column>reference</table-column>
            </cmp-field-mapping>
            <prefetch-group>
                <group>
                    <group-name>prefetchAll</group-name>
                    <cmp-field-name>reference</cmp-field-name>
                    <cmr-field>
                        <cmr-field-name>shippingAddress</cmr-field-name>
                    </cmr-field>
                    <cmr-field>
                        <cmr-field-name>billingAddress</cmr-field-name>
                    </cmr-field>
                    <cmr-field>
                        <cmr-field-name>lineItems</cmr-field-name>
                    </cmr-field>
                </group>
            </prefetch-group>
            <query>
                <query-method>
                    <method-name>findPrefetchAll</method-name>
                    <method-params>
                        <method-param>java.lang.Integer</method-param>
                    </method-params>
                </query-method>
                <group-name>prefetchAll</group-name>
            </query>
        </entity>
        <entity>
            <ejb-name>ProductBean</ejb-name>
            <table-name>product</table-name>
            <cmp-field-mapping>
                <cmp-field-name>id</cmp-field-name>
                <table-column>id</table-column>
            </cmp-field-mapping>
            <cmp-field-mapping>
                <cmp-field-name>name</cmp-field-name>
                <table-column>name</table-column>
            </cmp-field-mapping>
            <cmp-field-mapping>
                <cmp-field-name>productType</cmp-field-name>
                <table-column>product_type</table-column>
            </cmp-field-mapping>
            <prefetch-group>
                <group>
                    <group-name>prefetchAll</group-name>
                    <cmp-field-name>name</cmp-field-name>
                    <cmp-field-name>productType</cmp-field-name>
                </group>
            </prefetch-group>
        </entity>

        <session>
            <ejb-name>PrefetchFacadeBean</ejb-name>
            <jndi-name>cmp2/Prefetch/PrefetchFacade</jndi-name>
            <resource-ref>
                <ref-name>jdbc/CMPDatasource</ref-name>
                <application>null</application>
                <module>geronimo/default-database/${geronimo_version}/car</module>
                <name>DefaultDatasource</name>
            </resource-ref>
        </session>
    </enterprise-beans>

    <relationships>
        <ejb-relation>
            <ejb-relationship-role>
                <relationship-role-source>
                    <ejb-name>OrderBean</ejb-name>
                </relationship-role-source>
                <cmr-field>
                    <cmr-field-name>shippingAddress</cmr-field-name>
                </cmr-field>
                <foreign-key-column-on-source/>
                <role-mapping>
                    <cmr-field-mapping>
                        <key-column>id</key-column>
                        <foreign-key-column>fk_shipping_address</foreign-key-column>
                    </cmr-field-mapping>
                </role-mapping>
            </ejb-relationship-role>
        </ejb-relation>
        <ejb-relation>
            <ejb-relationship-role>
                <relationship-role-source>
                    <ejb-name>OrderBean</ejb-name>
                </relationship-role-source>
                <cmr-field>
                    <cmr-field-name>billingAddress</cmr-field-name>
                </cmr-field>
                <foreign-key-column-on-source/>
                <role-mapping>
                    <cmr-field-mapping>
                        <key-column>id</key-column>
                        <foreign-key-column>fk_billing_address</foreign-key-column>
                    </cmr-field-mapping>
                </role-mapping>
            </ejb-relationship-role>
        </ejb-relation>
        <ejb-relation>
            <ejb-relationship-role>
                <relationship-role-source>
                    <ejb-name>OrderBean</ejb-name>
                </relationship-role-source>
                <cmr-field>
                    <cmr-field-name>lineItems</cmr-field-name>
                </cmr-field>
                <role-mapping>
                    <cmr-field-mapping>
                        <key-column>id</key-column>
                        <foreign-key-column>fk_order</foreign-key-column>
                    </cmr-field-mapping>
                </role-mapping>
            </ejb-relationship-role>
        </ejb-relation>
        <ejb-relation>
            <ejb-relationship-role>
                <relationship-role-source>
                    <ejb-name>ProductBean</ejb-name>
                </relationship-role-source>
                <cmr-field>
                    <cmr-field-name>lineItems</cmr-field-name>
                </cmr-field>
                <role-mapping>
                    <cmr-field-mapping>
                        <key-column>id</key-column>
                        <foreign-key-column>fk_product</foreign-key-column>
                    </cmr-field-mapping>
                </role-mapping>
            </ejb-relationship-role>
        </ejb-relation>
    </relationships>

</openejb-jar>
