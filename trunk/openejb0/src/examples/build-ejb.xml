<project name="Example--Ejb" default="jar" basedir="./">
  <!-- 
  		Contributions by:
  			Daniel S. Haischt <sirabyss@gmx.net>
  	-->

  <property name="src.ejb.dir" value="${src.dir}/ejb"/>
  <property name="build.ejb.src" value="${build.src}/ejb"/>
  <property name="build.ejb.dest" value="${build.dest}/ejb"/>
  
  <!-- Build classpath -->
  <path id="project.classpath">
    <pathelement location="${ejb11.jar}"/>
    <pathelement location="${jndi.jar}"/>
  </path>

  <target name="prepare">
  
    <mkdir dir="${build.ejb.src}"/>
    <mkdir dir="${build.ejb.dest}"/>
        
    <copy todir="${build.ejb.src}">
      <fileset dir="${src.ejb.dir}" >
        <include name="**/**"/>
        <exclude name="**/CVS/**"/>
        <exclude name="**/*.class"/>
      </fileset>
    </copy>

    <replace file="${build.ejb.src}/org/acme/clients/Main.java" token="$$VERSION$$" value="${version}"/>

  </target>
  
  <target name="copy.manifest">
  
    <copy todir="${build.ejb.dest}/META-INF">
    
      <fileset dir="${src.ejb.dir}/META-INF" >
        <include name="ejb-jar.xml"/>
        <include name="openejb-jar.xml"/>
        <include name="MANIFEST.MF"/>
      </fileset>
      
    </copy>
    
    <replace file="${build.ejb.dest}/META-INF/MANIFEST.MF" token="$$VERSION$$" value="${version}"/>
    <replace file="${build.ejb.dest}/META-INF/MANIFEST.MF" token="$$OPENEJB_VERSION$$" value="${openejb.version}"/>
  
  </target>
    
  <!-- ================================================================== -->
  <!-- Compiles the source directory                                      -->
  <!-- ================================================================== -->
  
  <target name="compile"
          depends="prepare, compile.jdk12, compile.jdk13"
          description="--> compiles the java source files"/>
           
    <target name="compile.jdk12" unless="jdk13">
            
		<delete>
			<fileset dir="${build.openejb.server.src}" includes="**/Jdk13*.java"/>
		</delete>

		<javac srcdir="${build.ejb.src}"
			   destdir="${build.ejb.dest}"
			   debug="${debug}"
			   deprecation="${deprecation}">

		  <classpath>
			<path refid="project.classpath"/>
			<pathelement location="${build.dest}/openejb"/>
			<pathelement location="${build.dest}/loader"/>
		  </classpath>

		</javac>
            
    </target>
    
    <target name="compile.jdk13" if="jdk13">
            
		<javac srcdir="${build.ejb.src}"
			   destdir="${build.ejb.dest}"
			   debug="${debug}"
			   deprecation="${deprecation}">

		  <classpath>
			<path refid="project.classpath"/>
			<pathelement location="${build.dest}/openejb"/>
			<pathelement location="${build.dest}/loader"/>
		  </classpath>

		</javac>
            
    </target>

  <!-- ================================================================== -->
  <!-- Compiles the source directory and creates a .jar file              -->
  <!-- ================================================================== -->
  
  <target name="jar"
          depends="compile, copy.manifest"
          description="--> generates all java archives (default)">
    
    <jar jarfile="${openejb.dir}/beans/${project}_beans-${version}.jar"
         basedir="${build.ejb.dest}"
         includes="**/*.class,META-INF/*.xml"
         excludes="**/clients/**"
         manifest="${build.ejb.dest}/META-INF/MANIFEST.MF"/>

    <jar jarfile="${openejb.dir}/dist/${project}_clients-${version}.jar"
         basedir="${build.ejb.dest}"
         includes="**/*.class"
         excludes="**/*Bean*"
         manifest="${build.ejb.dest}/META-INF/MANIFEST.MF"/>

  </target>

  <target name="install"/>
      
  <!-- ================================================================== -->
  <!-- Cleans up the build directory                                      -->
  <!-- ================================================================== -->
    
  <target name="clean"
          description="--> cleans up the jars">
    <delete file="${openejb.dir}/beans/${project}_beans-${version}.jar"/>
    <delete file="${openejb.dir}/dist/${project}_clients-${version}.jar"/>
  </target>

</project>
