<?xml version="1.0" encoding="ISO-8859-1"?>

<!-- $Revision$ $Date$ -->

<project default="default"
  xmlns:j="jelly:core"
  xmlns:ant="jelly:ant"
  xmlns:maven="jelly:maven"
  xmlns:xdoclet="common:xdoclet">

  <preGoal name="xdoc:jelly-transform">
    <attainGoal name="html2xdoc"/>
  </preGoal>

  <preGoal name="jar:jar">
    <ant:jar destfile="${basedir}/target/openejb-webadmin-clienttools.jar">
      <fileset dir="${basedir}/target/classes" includes="**/webadmin/*.class,**/clienttools/**" />
      <metainf dir="${basedir}/src/java/org/openejb/webadmin/clienttools" includes="*.xml"/>
    </ant:jar>
    <ant:delete dir="${basedir}/target/classes/org/openejb/webadmin/clienttools"/>
  </preGoal>

  <preGoal name="jar:jar">
    <ant:jar destfile="${basedir}/target/openejb-webadmin-ejbgen.jar">
      <fileset dir="${basedir}/target/classes" includes="**/webadmin/*.class,**/ejbgen/**" />
      <metainf dir="${basedir}/src/java/org/openejb/webadmin/ejbgen" includes="*.xml"/>
    </ant:jar>
    <ant:delete dir="${basedir}/target/classes/org/openejb/webadmin/ejbgen"/>
  </preGoal>

  <preGoal name="jar:jar">
    <ant:jar destfile="${basedir}/target/openejb-webadmin-main.jar">
      <fileset dir="${basedir}/target/classes" includes="**/**" />
      <metainf dir="${basedir}/src/java/org/openejb/webadmin/main" includes="*.xml"/>
    </ant:jar>
    <ant:delete dir="${basedir}/target/classes"/>
    <ant:mkdir dir="${basedir}/target/classes"/>
  </preGoal>

  <preGoal name="jar:jar">
    <mkdir dir="${basedir}/target/resources"/>
    <copy file="${basedir}/src/webapp/WEB-INF/web.xml" todir="${basedir}/target/resources"/>
    <replace file="${basedir}/target/resources/web.xml" token="@OPENEJB_HOME@" 
             value="${basedir}/../../target/openejb-${pom.currentVersion}"/>

    <war destfile="${basedir}/target/openejb-webadmin-${pom.currentVersion}.war" webxml="${basedir}/target/resources/web.xml">
      <fileset dir="${basedir}/src/webapp">
        <exclude name="WEB-INF/web.xml"/>
      </fileset>
      <lib dir="${basedir}/../core/target/">
        <include name="openejb-loader-${pom.currentVersion}.jar"/>
      </lib>
    </war>
    
    <delete dir="${basedir}/target/resources"/>
  </preGoal>
  
<!--
  <postGoal name="jar:jar">
    <ant:delete file="${basedir}/target/openejb-webadmin-${pom.currentVersion}.jar"/>
  </postGoal>
  <postGoal name="jar:jar">
    <copy todir="${build.clienttools.src}">
      <fileset dir="${src.clienttools.dir}" >
        <include name="**/clienttools/**"/>
        <include name="**/admin/web/WebAdminBean**"/>
        <exclude name="**/CVS/**"/>
        <exclude name="**/javax/**"/>
        <exclude name="**/*.class"/>
      </fileset>
    </copy>
    <ant:jar destfile="${basedir}/target/geronimo-core-rmiclassloaderspi.jar"
             basedir="${basedir}/target/classes"
             includes="org/apache/geronimo/rmi/RMIClassLoaderSpiImpl.class"/>
    <ant:jar todir="${basedir}/target/classes/htdocs">
       <fileset dir="${basedir}/src/java/org/openejb/admin/web/html"/>
    </ant:copy>
  </postGoal>
-->  
<!--
  <postGoal name="jar:jar">
    <ant:jar destfile="${basedir}/target/geronimo-core-rmiclassloaderspi.jar"
             basedir="${basedir}/target/classes"
             includes="org/apache/geronimo/rmi/RMIClassLoaderSpiImpl.class"/>
  </postGoal>

  <postGoal name="jar:jar">
    <ant:jar destfile="${basedir}/target/geronimo-schemas.jar"
             basedir="${basedir}/src/schema"
             includes="*.xsd"/>
  </postGoal>
-->
</project>
